require.config({baseUrl:"../../dist",paths:{zepto:"libs/zepto.min",jquery:"libs/jquery-2.1.3.min"}}),require(["jquery","utils/caimi-imgload","utils/caimi-core-url","utils/caimi-version","utils/caimi-core-islogin"],function(a,b,c,d,e){var f,g=function(){for(var a=document.getElementById("tab"),b=a.getElementsByTagName("div")[0],c=b.getElementsByTagName("span"),d=b.getElementsByTagName("img"),e=!0,f=a.getElementsByTagName("div")[1],g=f.getElementsByTagName("ul"),h=0;h<c.length;h++)c[h].index=h,c[h].onclick=function(){j(this.index)};var j=function(a){for(var b=0;b<c.length;b++)d[b].style.display="none",g[b].style.display="none";d[a].style.display="block",g[a].style.display="block",1===a&e&&(e=!1,i.init())};return{changeTab:j}},h=function(){var b={oData:{bBtn:!0,userCode:e.getData().userCode,isBind:!1,bCash:!1},init:function(){var d={},e=a(".btn_wycy").eq(0);b.oData.userCode||e.html("登录参与"),e.on("touchend",b.toPartake),require(["utils/caimi-core-ajax"],function(a){var g=a.loginStatus;a.post(c.activitylist,{group:3,userCode:b.oData.userCode,clientSid:g.sid},function(a){if("0000"===a.code){try{a.result.exchangeList.length||e.addClass("disabled").html("活动已结束")}catch(c){}try{d=a.result.exchangeList[0].detailList[0],f=d.exchangeDetailId,"3"==d.status&&b.showScuess(),"2"==d.status&&b.oData.userCode&&(e.addClass("disabled").html("活动已结束"),f="")}catch(c){}0===a.result.bindMobile&&(b.oData.isBind=!0),a.result.cashAmount<50&&(b.oData.bCash=!0)}else require(["utils/caimi-core-layer"],function(b){b.error(a.msg)})})})},toPartake:function(){function d(){require(["utils/caimi-core-layer"],function(a){a.confirmLayer({tit:"请绑定手机后参与活动",accept:{label:"去绑定",callBack:function(){this.hide(),location.href="icaimi:host:bind"}},cancel:{label:"取消",callBack:function(){}}})})}function e(a){require(["utils/caimi-core-layer"],function(d){d.confirmLayer({tit:"请确认是否参与50得90活动？",accept:{label:"确定兑换",callBack:function(){this.hide(),b.oData.bBtn&&f&&(b.oData.bBtn=!1,require(["utils/caimi-core-ajax"],function(d){k.html("请稍后..."),d.post(c.joinExchange,{userCode:b.oData.userCode,exchangeDetailId:f,machId:a.machId},function(a){var c;"0000"===a.code?(c=a.result.code,"0000"===c?(b.showScuess(),require(["utils/caimi-core-layer"],function(a){a.alert("您已成功兑换")})):"2009"===c?(b.toExcharge(h),g(j)):(require(["utils/caimi-core-layer"],function(b){b.error(a.result.msg)}),g(j))):(require(["utils/caimi-core-layer"],function(b){b.error(a.msg)}),g(j))})}))}},cancel:{label:"再看看",callBack:function(){}}})})}function g(a){k.html(a),b.oData.bBtn=!0}var h,i,j,k=a(this);j=k.html(),require(["utils/caimi-core-versionnumber"],function(a){h=a.version,i=a.loginStatus,b.oData.userCode=i.userCode,f&&(b.oData.userCode?b.oData.isBind?d():b.oData.bCash?b.toExcharge(h):e(i):location.href="icaimi:host:login")})},showScuess:function(){b.getStaging(),a(".btn_wycy").hide().next().hide(),tabBtn=!1},toExcharge:function(a){require(["utils/caimi-core-layer"],function(b){a.iphone?b.alert("您的余额不足，请立即充值"):b.confirmLayer({tit:"您的现金余额不足，是否充值？",accept:{label:"去充值",callBack:function(){this.hide(),location.href="icaimi:host:recharge"}},cancel:{label:"取消",callBack:function(){}}})})},getStaging:function(){var d=a(".success-tips");require(["utils/caimi-core-ajax","libs/template.min"],function(e,g){e.post(c.listUserStaging,{userCode:b.oData.userCode,exchangeDetailId:f},function(b){if("0000"===b.code){d.show();var c=g("stagingTemp",b.result);a("#staging").html(c)}})})}};return b}();h.init();var i=function(){var b={oData:{bBtn:!0},init:function(){require(["utils/caimi-core-ajax"],function(d){var e=d.loginStatus;""===e.userCode?a(".show-base-reword").html('<a class="btn_wycy" href="icaimi:host:login">登陆查看</a>'):d.post(c.awardDetail,{userCode:e.userCode,privateKey:e.id,shareType:"active"},function(c){if("0000"===c.code)if(""===c.result)a(".show-base-reword").html('<a class="btn_wycy disabled" href="#">活动已结束</a>');else{try{c.result.extraAwardList=c.result.extraAwardList.reverse(),d.loginStatus.userCode?a(".reword-status").show():c.result.baseAward.amount=-1}catch(e){}b.showList(c.result)}})})},showList:function(c){var d,e,f;f=function(){for(var a=parseFloat(c.baseAward.amount),b=c.extraAwardList,d=0;d<b.length;d++)1===b[d].receiveStatus&&(a+=parseFloat(b[d].amount));c.baseAward.amount=a,a>=30&&60>a?c.baseAward.progress=a+3:a>30&&60>=a&&(c.baseAward.progress=a+6)},f(),console.log(c),d=template("base",c.baseAward),a(".show-base-reword").html(d),e=template("temcont",c),a(".reword-status").html(e),b.takeReword()},takeReword:function(){var d,e,f,g=!0;a(".take-btns a").on("touchend",function(){d=this.dataset.id,f=a(this),e=f.parents(".can-take"),g&&d&&(g=!1,e.hasClass("disabled")||require(["utils/caimi-core-ajax"],function(a){a.post(c.receiveAward,{shareExtraId:d},function(a){"0000"===a.code?(f.html("已领取").parents("span").addClass("taked"),b.init()):(require(["utils/caimi-core-layer"],function(b){b.error(a.msg)}),g=!0)})}))})}};return b}(),j=function(){var c={init:function(){location.search;b.imgLoad(a("img[_src]").get(),function(){a(".loading").hide().next().show()}),g()}};return c}();j.init()});